<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>JSDoc: Source: tribe.js</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	
	<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
	<link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body data-page-title="Source: tribe.js">

	<div id="main">
		
		<h1 class="page-title">Source: tribe.js</h1>
		
		


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** A solution to the hilarious over-use of "ajax frameworks".
 *
 * If called as a function, `tribe()` is an alias of {@link module:tribe.request `tribe.request()`}
 * @module tribe
 *
 * @example
 *	&lt;caption>Basic Usage&lt;/caption>
 *	// grab the library:
 *	require(['tribe'], function(tribe) {
 *
 *		// Log requests before they go out:
 *		tribe.on('req', function(e) {
 *			console.log('Request: ', e.req);
 *		});
 *
 *		// Log responses when they come in:
 *		tribe.on('res', function(e) {
 *			console.log('Response: ', e.res);
 *		});
 *
 *		// Make a basic GET request:
 *		tribe('/api/todos', function(err, data) {
 *			if (err) throw err;
 *			var names = data.map(function(todo){ return todo.name; });
 *			alert('ToDos: ' + names.join(', '));
 *		});
 *	});
 */
(function(factory) {
	if (typeof define==='function' &amp;&amp; define.amd) {
		define([], factory);
	}
	else if (typeof module==='object' &amp;&amp; module.exports) {
		module.exports = factory();
	}
	else {
		window.tribe = factory();
	}
}(function() {
	var events = { req:[], res:[] },
		methods = 'GET POST PUT DELETE HEAD'.split(' '),
		hop = {}.hasOwnProperty;

	/** Issue an HTTP request.
	 * @memberOf module:tribe
	 * @name request
	 * @function
	 * @param {Object|String} options			Options for the request, or a `String` `"url"` to which a GET request should be issued.
	 * @param {String} [opt.method=GET]		HTTP method
	 * @param {String} [opt.url=/]				The URL to request
	 * @param {String|FormData|Blob|ArrayBufferView} [opt.body=none]		Request body, for HTTP methods that allow it. Supported types: [XMLHttpRequest#send](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#send())
	 * @param {Object} [opt.headers={ }]		A map of request headers
	 * @param {String} [opt.user=none]			Authentication username, if basic auth is to be used
	 * @param {String} [opt.pass=none]			Authentication password for basic auth
	 * @param {Function} callback				A function to call when the request has completed (error or success). Gets passed `(err, data, res)`.
	 *
	 * @example
	 *	&lt;caption>"Kitchen Sync"&lt;/caption>
	 *	tribe({
	 *		method : 'PUT',
	 *		url : 'http://foo.com/bar.json',
	 *		headers : {
	 *			'Content-Type' : 'application/json'
	 *		},
	 *		user : 'bob',
	 *		pass : 'firebird',
	 *		body : JSON.stringify({ key : 'value' })
	 *	}, function(err, data, res) {
	 *		if (err) throw err;
	 *		console.log(res.status===204, data);
	 *	});
	 */
	function tribe(opt, callback) {
		opt = typeof opt==='string' ? {url:opt} : opt || {};
		opt.headers = opt.headers || {};
		var xhr = new XMLHttpRequest(),
			e = { xhr:xhr, req:opt };
		emit('req', e);
		(xhr = e.xhr).open(opt.method || 'GET', opt.url || '/', true, opt.user, opt.pass);
		for (var name in opt.headers) if (hop.call(opt.headers, name)) xhr.setRequestHeader(name, opt.headers[name]);
		xhr.onreadystatechange = function() {
			if (xhr.readyState!==4) return;
			var res = {
					status : xhr.status,
					error : xhr.status>399 ? xhr.statusText : null,
					headers : {},
					body : xhr.responseText,
					xml : xhr.responseXML,
					xhr : xhr
				},
				hreg = /^\s*([a-z0-9_-]+)\s*\:\s*(.*?)\s*$/gim,
				h = xhr.getAllResponseHeaders(),
				m;
			try{ res.json = JSON.parse(res.body); }catch(e){}
			res.data = res.json || res.xml || res.body;
			while (m=hreg.exec(h)) res.headers[m[1].toLowerCase()] = m[2];
			e.res = res;
			emit('res', e);
			(callback || opt.callback).call(e, res.error, res.data, res);
		};
		xhr.send(opt.body);
	}


	/**Register a handler function to be called in response to a given type of event.
	 * Valid event types are: `req` and `res`, fired on request and response respectively.
	 * @example
	 *	tribe.on('res', function(e) {
	 *		// e.req
	 *		// e.res
	 *		// e.xhr
	 *	});
	 * @param {String} type			An event type to observe
	 * @param {Function} handler	Handler function, gets passed an Event object
	 */
	tribe.on = function(type, handler) {
		events[type].push(handler);
	};


	function emit(type, args) {
		args = Array.prototype.slice.call(arguments, 1);
		for (var e=events[type], i=e.length; i--; ) e[i].apply(tribe, args);
	}

	function alias(overrides) {
		return function(opt, callback) {
			return tribe(extend({}, typeof opt==='string' ? {url:opt} : opt, overrides), callback);
		};
	}

	/**Alias of {@link module:tribe.request request()} that presupplies the option `method:'GET'`
	 * @name module:tribe.get
	 * @function
	 *
	 * @example
	 *	&lt;caption>Get popular YouTube videos&lt;/caption>
	 *	var url = 'http://gdata.youtube.com/feeds/api/standardfeeds/most_popular?v=2&amp;alt=json';
	 *	tribe.get(url, function(err, data) {
	 *		if (err) throw err;
	 *		// display video links:
	 *		document.body.innerHTML = data.feed.entry.map(function(vid) {
	 *			return vid.title.$t.anchor(vid.content.src);	// String#neverforget
	 *		}).join('&lt;br>');
	 *	});
	 */

	/**Alias of {@link module:tribe.request request()} that presupplies the option `method:'POST'`
	 * @name module:tribe.post
	 * @function
	 *
	 * @example
	 *	&lt;caption>Submit a contact form&lt;/caption>
	 *	tribe.post({
	 *		url : 'http://example.com/contact-form.php',
	 *		headers : {
	 *			'Content-Type' : 'application/x-www-form-encoded'
	 *		},
	 *		body : new FormData(document.querySelector('form'))
	 *	}, function(err, data) {
	 *		if (err) throw err;
	 *		alert('Submitted: ' + data.message);
	 *	});
	 */

	/** Alias of {@link module:tribe.request request()} that presupplies the option `method:'PUT'`
	 * @name module:tribe.put
	 * @function
	 *
	 * @example
	 *	&lt;caption>Update a REST resource&lt;/caption>
	 *	tribe.put({
	 *		url : 'http://foo.com/bar.json',
	 *		headers : { 'Content-Type':'application/json' },
	 *		body : '{"key":"val"}'
	 *	}, function(err, data) {
	 *		if (err) throw err;
	 *		console.log(data);
	 *	});
	 */

	/**	Alias of {@link module:tribe.request request()} that presupplies the option `method:'HEAD'`
	 *	@name module:tribe.head
	 *	@function
	 *
	 * @example
	 *	&lt;caption>Get headers&lt;/caption>
	 *	tribe.head('/massive.json', function(err, data, res) {
	 *		if (err) throw err;
	 *		console.log(res.headers);
	 *	});
	 */

	/**	Alias of {@link module:tribe.request request()} that presupplies the option `method:'DELETE'`
	 *	@name module:tribe.del
	 *	@function
	 *
	 * @example
	 *	&lt;caption>Delete a REST resource&lt;/caption>
	 *	tribe.del({
	 *		url : '/api/items/1a2b3c'
	 *	}, function(err, data) {
	 *		if (err) throw err;
	 *		alert('Deleted');
	 *	});
	 */

	/**	Alias of {@link module:tribe.del del()}.
	 *  This alias is provided for completeness, but [should not be used](http://mothereff.in/js-properties#delete) because [it throws in ES3](http://mathiasbynens.be/notes/javascript-properties).
	 *	@name module:tribe.delete
	 *	@function
	 *	@deprecated Don't call &lt;code>delete()&lt;/code> if you need to support ES3. &lt;code>tribe['delete']()&lt;/code> is okay.
	 */

	for (var i=methods.length; i--; ) {
		tribe[methods[i].toLowerCase()] = alias({ method:methods[i] });
	}
	tribe.del = tribe['delete'];

	function extend(base, obj) {
		for (var i=1, p, o; i&lt;arguments.length; i++) {
			o = arguments[i];
			for (p in o) if (hop.call(o, p)) base[p] = o[p];
		}
		return base;
	}

	tribe.tribe = tribe.request = tribe;
	return tribe;
}));
</code></pre>
        </article>
    </section>




	</div>
	
	<a class="menuLink">Menu</a>
	
	<nav>
		<h2><a href="index.html">tribe</a></h2><h3>Modules</h3><ul><li title="module:tribe"><a href="module-tribe.html">tribe</a></li></ul>
	</nav>

	<footer>
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Fri Jul 18 2014 14:55:15 GMT-0400 (EDT)
	</footer>

	<script src="scripts/prettify/prettify.js"></script>
	<script src="scripts/prettify/lang-css.js"></script>
	<script src="scripts/enhancements.js"> </script>
</body>
</html>
